{"ast":null,"code":"import _slicedToArray from \"/Users/alexandroaguilar/Desarrollo/Backup/tiburon-master/aPOS/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/alexandroaguilar/Desarrollo/Backup/tiburon-master/aPOS/src/components/StockAdd.js\";\nimport React from 'react';\nimport { TextField } from 'office-ui-fabric-react/lib/TextField';\nimport AppContext from '../context/AppContext';\nimport { Dropdown } from 'office-ui-fabric-react/lib/Dropdown';\nimport ExpansionPanel from '@material-ui/core/ExpansionPanel';\nimport ExpansionPanelDetails from '@material-ui/core/ExpansionPanelDetails';\nimport ExpansionPanelSummary from '@material-ui/core/ExpansionPanelSummary';\nimport { ComboBox } from 'office-ui-fabric-react/lib/index';\nimport { PrimaryButton } from 'office-ui-fabric-react/lib/Button';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nimport moment from 'moment';\nimport axios from 'axios';\n\nclass StockAdd extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this._onCustomerChange = customer => {\n      this.setState({\n        customer\n      });\n    };\n\n    this._onProductChange = product => {\n      this.setState({\n        product\n      });\n    };\n\n    this._onAmmountChange = (e, ammount) => {\n      this.setState({\n        ammount\n      });\n    };\n\n    this._onPriceChange = (e, price) => {\n      this.setState({\n        selling_price: price\n      });\n    };\n\n    this._onIVAChange = (e, IVA) => {\n      this.setState({\n        IVA: IVA.key\n      });\n    };\n\n    this._onCashChange = (e, cash) => {\n      this.setState({\n        cash: cash.key\n      });\n    };\n\n    this._onSaleTypeChange = (e, sale_type) => {\n      this.setState({\n        sale_type: sale_type.key\n      });\n    };\n\n    this._onDescriptionChange = (e, description) => {\n      this.setState({\n        description\n      });\n    };\n\n    this._getCustomers = () => {\n      if (this.state.customers.length > 0) {\n        return this.state.customers;\n      }\n\n      let customers = this.props.customers.map(customer => ({\n        key: customer.customer_id,\n        text: customer.customer_name\n      }));\n      this.setState({\n        customers\n      });\n    };\n\n    this._onCustomersChange = (event, option, index, value) => {\n      //this is type change handler\n      if (this.state.customer === undefined) {\n        this.setState({\n          customer: value\n        });\n      } else {\n        this.setState({\n          customer: option.key\n        });\n      }\n    };\n\n    this._getProducts = () => {\n      if (this.state.products.length > 0) {\n        return this.state.products;\n      }\n\n      let products = this.props.products.map(product => ({\n        key: product.product_id,\n        text: product.product_name + ' ' + product.category_name,\n        cost_price: product.cost_price,\n        selling_price: product.selling_price\n      }));\n      this.setState({\n        products\n      });\n    };\n\n    this._onProductsChange = (event, option, index, value) => {\n      //this is type change handler\n      if (this.state.product === undefined) {\n        this.setState({\n          product: value\n        });\n      } else {\n        this.setState({\n          product: option.key,\n          selling_price: option.selling_price,\n          cost_price: option.cost_price\n        });\n      }\n    };\n\n    this.state = {\n      customer: null,\n      product: null,\n      ammount: '',\n      selling_price: '0',\n      cost_price: '0',\n      IVA: 0,\n      cash: 0,\n      movementType: null,\n      sale_type: 0,\n      description: '',\n      options: [{\n        key: 1,\n        text: 'Merma'\n      }, {\n        key: 2,\n        text: 'Prueba de control'\n      }, {\n        key: 3,\n        text: 'Cortesía'\n      }, {\n        key: 4,\n        text: 'Venta'\n      }, {\n        key: 5,\n        text: 'Consumo personal'\n      }],\n      customers: [],\n      products: [],\n      initialDisplayValue: '',\n      textFields: {\n        customer: false,\n        product: false,\n        ammount: false,\n        price: false,\n        IVA: false,\n        cash: false,\n        sale_type: false,\n        description: false\n      }\n    };\n  }\n\n  componentDidMount() {\n    this._getCustomers();\n\n    this._getProducts();\n  }\n\n  componentDidCatch(error) {\n    console.log(error);\n  }\n\n  render() {\n    return React.createElement(AppContext.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159\n      },\n      __self: this\n    }, context => React.createElement(\"div\", {\n      className: \"ProductsControl\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"ProductsControlPanel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, React.createElement(AddMovementPanel, {\n      person: context.state.user.personal_id,\n      customer: this.state.customer,\n      _onCustomerChange: this._onCustomerChange,\n      product: this.state.product,\n      _onProductChange: this._onProductChange,\n      ammount: this.state.ammount,\n      _onAmmountChange: this._onAmmountChange,\n      selling_price: this.state.selling_price,\n      _onPriceChange: this._onPriceChange,\n      cost_price: this.state.cost_price,\n      cash: this.state.cash,\n      _onCashChange: this._onCashChange,\n      IVA: this.state.IVA,\n      _onIVAChange: this._onIVAChange,\n      movementType: this.state.movementType,\n      _onMovementTypeChange: this._onMovementTypeChange,\n      sale_type: this.state.sale_type,\n      _onSaleTypeChange: this._onSaleTypeChange,\n      description: this.state.description,\n      _onDescriptionChange: this._onDescriptionChange,\n      options: this.state.options,\n      textFields: this.state.textFields,\n      initialDisplayValue: this.state.initialDisplayValue,\n      customers: this.state.customers,\n      _getCustomers: this._getCustomers,\n      _onCustomersChange: this._onCustomersChange,\n      products: this.state.products,\n      _getProducts: this._getProducts,\n      _onProductsChange: this._onProductsChange,\n      _showAlert: this.props._showAlert,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nfunction AddMovementPanel(props) {\n  const _React$useState = React.useState(false),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        expanded = _React$useState2[0],\n        setExpanded = _React$useState2[1];\n\n  const _getTotal = () => {\n    if (props.IVA === 1) return String(props.ammount * props.selling_price + props.ammount * props.selling_price * 0.16);\n    return String(props.ammount * props.selling_price);\n  };\n\n  const _handleSubmit = async () => {\n    console.log(props.sale_type + ' ' + props.movementType);\n    axios.post('http://localhost:8000/payments', {\n      ammount: 0,\n      date: new Date(),\n      description: props.description,\n      product: props.product,\n      quantity: props.quantity,\n      price: props.price\n    }).then(response => {\n      console.log(response);\n    }).catch(error => {\n      console.log(error);\n    });\n\n    if (props.sale_type === 0 && props.movementType === 4) {\n      axios.post('http://localhost:8000/deposits', {\n        deposit_date: new Date(),\n        payment_type: 0,\n        customer: props.customer,\n        ammount: _getTotal()\n      }).then(response => {\n        console.log(response);\n      }).catch(error => {\n        console.error(error);\n      });\n    }\n\n    axios.post('http://localhost:8000/sales', {\n      movement_date: new Date(),\n      customer: props.customer,\n      person: props.person,\n      product: props.product,\n      ammount: props.ammount,\n      selling_price: props.selling_price,\n      cost_price: props.cost_price,\n      IVA: props.IVA,\n      cash: props.cash,\n      movementType: props.movementType,\n      sale_type: props.sale_type,\n      description: props.description\n    }).then(response => {\n      console.log(response);\n\n      props._onCustomerChange(null);\n\n      props._onProductChange(null);\n\n      props._onAmmountChange(null, '');\n\n      props._onDescriptionChange(null, '');\n\n      props._showAlert('Agregado con éxito.', 'Éxito: ');\n    }).catch(error => {\n      console.log(error);\n    });\n    var product = await axios.put('http://localhost:8000/products/stock', {\n      product: props.product,\n      ammount: props.ammount\n    });\n    console.log(product);\n  };\n\n  return React.createElement(AppContext.Consumer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235\n    },\n    __self: this\n  }, context => React.createElement(Paper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      flexDirection: 'column',\n      margin: 2 + 'em'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238\n    },\n    __self: this\n  }, React.createElement(ComboBox, {\n    selectedKey: props.product,\n    label: \"Producto\",\n    allowFreeform: true,\n    autoComplete: \"on\",\n    options: props.products,\n    onChange: props._onProductsChange,\n    onResolveOptions: props._getProducts,\n    text: props.initialDisplayValue,\n    required: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239\n    },\n    __self: this\n  }), React.createElement(TextField, {\n    label: \"Unidades\",\n    value: props.ammount,\n    onChange: props._onAmmountChange,\n    styles: {\n      fieldGroup: {\n        width: 300\n      }\n    },\n    autoComplete: \"off\",\n    type: \"number\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240\n    },\n    __self: this\n  }), React.createElement(TextField, {\n    label: \"Precio\",\n    value: props.selling_price,\n    onChange: props._onPriceChange,\n    styles: {\n      fieldGroup: {\n        width: 300\n      }\n    },\n    autoComplete: \"off\",\n    type: \"number\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241\n    },\n    __self: this\n  }), props.textFields.description ? React.createElement(TextField, {\n    label: \"Descripci\\xF3n\",\n    value: props.description,\n    onChange: props._onDescriptionChange,\n    styles: {\n      fieldGroup: {\n        width: 300\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242\n    },\n    __self: this\n  }) : null, props.textFields.IVA ? React.createElement(TextField, {\n    label: \"Total: \",\n    value: _getTotal(),\n    onChange: props._onDescriptionChange,\n    styles: {\n      fieldGroup: {\n        width: 300\n      }\n    },\n    readOnly: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243\n    },\n    __self: this\n  }) : null, React.createElement(PrimaryButton, {\n    onClick: () => _handleSubmit(),\n    style: {\n      marginTop: '2em'\n    },\n    disabled: false,\n    text: \"Agregar\",\n    type: \"submit\",\n    allowDisabledFocus: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244\n    },\n    __self: this\n  }))));\n}\n\nexport default StockAdd; //","map":{"version":3,"sources":["/Users/alexandroaguilar/Desarrollo/Backup/tiburon-master/aPOS/src/components/StockAdd.js"],"names":["React","TextField","AppContext","Dropdown","ExpansionPanel","ExpansionPanelDetails","ExpansionPanelSummary","ComboBox","PrimaryButton","Table","TableBody","TableCell","TableHead","TableRow","Paper","moment","axios","StockAdd","Component","constructor","props","_onCustomerChange","customer","setState","_onProductChange","product","_onAmmountChange","e","ammount","_onPriceChange","price","selling_price","_onIVAChange","IVA","key","_onCashChange","cash","_onSaleTypeChange","sale_type","_onDescriptionChange","description","_getCustomers","state","customers","length","map","customer_id","text","customer_name","_onCustomersChange","event","option","index","value","undefined","_getProducts","products","product_id","product_name","category_name","cost_price","_onProductsChange","movementType","options","initialDisplayValue","textFields","componentDidMount","componentDidCatch","error","console","log","render","context","user","personal_id","_onMovementTypeChange","_showAlert","AddMovementPanel","useState","expanded","setExpanded","_getTotal","String","_handleSubmit","post","date","Date","quantity","then","response","catch","deposit_date","payment_type","movement_date","person","put","display","flexDirection","margin","fieldGroup","width","marginTop"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { TextField } from 'office-ui-fabric-react/lib/TextField';\nimport AppContext from '../context/AppContext';\nimport { Dropdown } from 'office-ui-fabric-react/lib/Dropdown';\nimport ExpansionPanel from '@material-ui/core/ExpansionPanel';\nimport ExpansionPanelDetails from '@material-ui/core/ExpansionPanelDetails';\nimport ExpansionPanelSummary from '@material-ui/core/ExpansionPanelSummary';\nimport { ComboBox } from 'office-ui-fabric-react/lib/index';\nimport { PrimaryButton } from 'office-ui-fabric-react/lib/Button';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nimport moment from 'moment';\nimport axios from 'axios';\n\nclass StockAdd extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      customer: null,\n      product: null,\n      ammount: '',\n      selling_price: '0',\n      cost_price: '0',\n      IVA: 0,\n      cash: 0,\n      movementType: null,\n      sale_type: 0,\n      description: '',\n      options: [{key: 1, text: 'Merma'}, {key:2, text: 'Prueba de control'}, {key: 3, text: 'Cortesía'}, {key: 4, text: 'Venta'}, {key:5, text: 'Consumo personal'}],\n      customers: [],\n      products: [],\n      initialDisplayValue: '',\n      textFields: {\n        customer: false,\n        product: false,\n        ammount: false,\n        price: false,\n        IVA: false,\n        cash: false,\n        sale_type: false,\n        description: false,\n      }\n    }\n  }\n\n  componentDidMount() {\n    this._getCustomers();\n    this._getProducts();\n  }\n\n  _onCustomerChange = (customer) => {\n    this.setState({\n      customer\n    });\n  }\n\n  _onProductChange = (product) => {\n    this.setState({\n      product\n    });\n  }\n\n  _onAmmountChange = (e, ammount) => {\n    this.setState({\n      ammount\n    });\n  }\n\n  _onPriceChange = (e, price) => {\n    this.setState({\n      selling_price: price\n    });\n  }\n\n  _onIVAChange = (e, IVA) => {\n    this.setState({\n      IVA: IVA.key\n    });\n  }\n\n  _onCashChange = (e, cash) => {\n    this.setState({\n      cash: cash.key\n    });\n  }\n\n  _onSaleTypeChange = (e, sale_type) => {\n    this.setState({\n      sale_type: sale_type.key\n    });\n  }\n\n  _onDescriptionChange = (e, description) => {\n    this.setState({\n      description\n    });\n  }\n\n  _getCustomers = () => {\n    if(this.state.customers.length > 0) {\n      return this.state.customers;\n    }\n    let customers = this.props.customers.map(customer => (\n      {key: customer.customer_id, text: customer.customer_name}\n    ));\n    this.setState({\n      customers\n    });\n  }\n\n  _onCustomersChange = (event, option, index, value) => { //this is type change handler\n    if(this.state.customer === undefined){\n      this.setState({\n        customer: value\n      })  \n    } else {\n      this.setState({\n        customer: option.key\n      })  \n    }\n  }\n\n  _getProducts = () => {\n    if(this.state.products.length > 0) {\n      return this.state.products;\n    }\n    let products = this.props.products.map(product => (\n      {key: product.product_id, text: product.product_name + ' ' + product.category_name, cost_price: product.cost_price, selling_price: product.selling_price}\n    ));\n    this.setState({\n      products\n    });\n  }\n\n  _onProductsChange = (event, option, index, value) => { //this is type change handler\n    if(this.state.product === undefined){\n      this.setState({\n        product: value\n      });\n    } else {\n      this.setState({\n        product: option.key,\n        selling_price: option.selling_price,\n        cost_price: option.cost_price\n      });\n    }\n  }\n\n  componentDidCatch(error) {\n    console.log(error);\n  }\n\n  render() {\n    return (\n      <AppContext.Consumer>\n      \t{context => (\n      \t\t<div className=\"ProductsControl\">\n            <div className=\"ProductsControlPanel\">\n              <AddMovementPanel\n                person={context.state.user.personal_id}\n                customer={this.state.customer} _onCustomerChange={this._onCustomerChange}\n                product={this.state.product} _onProductChange={this._onProductChange}\n                ammount={this.state.ammount} _onAmmountChange={this._onAmmountChange}\n                selling_price={this.state.selling_price} _onPriceChange={this._onPriceChange}\n                cost_price={this.state.cost_price}\n                cash={this.state.cash} _onCashChange={this._onCashChange}\n                IVA={this.state.IVA} _onIVAChange={this._onIVAChange}\n                movementType={this.state.movementType} _onMovementTypeChange={this._onMovementTypeChange}\n                sale_type={this.state.sale_type} _onSaleTypeChange={this._onSaleTypeChange}\n                description={this.state.description} _onDescriptionChange={this._onDescriptionChange}\n                options={this.state.options}\n                textFields={this.state.textFields}\n                initialDisplayValue={this.state.initialDisplayValue}\n                customers={this.state.customers} _getCustomers={this._getCustomers} _onCustomersChange={this._onCustomersChange}\n                products={this.state.products} _getProducts={this._getProducts} _onProductsChange={this._onProductsChange}\n                _showAlert={this.props._showAlert}\n              />\n            </div>\n          </div>\n      \t)}\n      </AppContext.Consumer>\n    );\n  }\n  \n}\n\nfunction AddMovementPanel(props) {\n  const [expanded, setExpanded] = React.useState(false);\n\n  const _getTotal = () => {\n    if(props.IVA === 1)\n     return String(props.ammount * props.selling_price + (props.ammount * props.selling_price * 0.16));\n    return String(props.ammount * props.selling_price);\n  }\n\n  const _handleSubmit = async () => {\n    console.log(props.sale_type + ' ' + props.movementType);\n    axios.post('http://localhost:8000/payments', {ammount: 0, date: new Date(), description: props.description, product: props.product, quantity: props.quantity, price: props.price})\n    .then(response => {\n      console.log(response);\n    })\n    .catch(error => {\n      console.log(error);\n    });\n    if (props.sale_type === 0 && props.movementType === 4) {\n      axios.post('http://localhost:8000/deposits', {deposit_date: new Date(), payment_type: 0, customer: props.customer, ammount: _getTotal()})\n      .then(response => {\n        console.log(response);\n      })\n      .catch(error => {\n        console.error(error);\n      });\n    }\n    axios.post('http://localhost:8000/sales', {movement_date: new Date(), customer: props.customer, person: props.person, product: props.product, ammount: props.ammount, selling_price: props.selling_price, cost_price: props.cost_price, IVA: props.IVA, cash:props.cash, movementType: props.movementType, sale_type: props.sale_type, description: props.description})\n    .then(response => {\n      console.log(response);\n      props._onCustomerChange(null);\n      props._onProductChange(null);\n      props._onAmmountChange(null, '');\n      props._onDescriptionChange(null, '');\n      props._showAlert('Agregado con éxito.', 'Éxito: ')\n    })\n    .catch(error => {\n      console.log(error);\n    });\n    var product = await axios.put('http://localhost:8000/products/stock', {product: props.product, ammount: props.ammount});\n    console.log(product);\n  }\n\n  return (\n    <AppContext.Consumer>\n      {context => (\n        <Paper>\n          <div style={{display: 'flex', flexDirection: 'column', margin: 2 + 'em'}}>\n            <ComboBox selectedKey={props.product} label=\"Producto\" allowFreeform={true} autoComplete=\"on\" options={props.products} onChange={props._onProductsChange} onResolveOptions={props._getProducts} text={props.initialDisplayValue} required/>\n            <TextField label=\"Unidades\" value={props.ammount} onChange={props._onAmmountChange} styles={{ fieldGroup: { width: 300 } }} autoComplete=\"off\" type=\"number\"/>\n            <TextField label=\"Precio\" value={props.selling_price} onChange={props._onPriceChange} styles={{fieldGroup: {width: 300} }} autoComplete=\"off\" type=\"number\"/>\n            {props.textFields.description ? <TextField label=\"Descripción\" value={props.description} onChange={props._onDescriptionChange} styles={{ fieldGroup: { width: 300 } }}/> : null}\n            {props.textFields.IVA ? <TextField label=\"Total: \" value={_getTotal()} onChange={props._onDescriptionChange} styles={{ fieldGroup: { width: 300 } }} readOnly={true}/> : null}\n            <PrimaryButton onClick={() => _handleSubmit()} style={{marginTop: '2em'}} disabled={false} text=\"Agregar\" type=\"submit\" allowDisabledFocus={true}/>\n          </div>\n        </Paper>\n      )}\n    </AppContext.Consumer>\n  );\n}\n\nexport default StockAdd;\n\n//"]},"metadata":{},"sourceType":"module"}